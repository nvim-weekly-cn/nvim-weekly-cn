# Neovim 周报：2025年5月26日至6月1日

## Neovim 开发近况

本周 Neovim 并无新的变化，主要集中在 bug 修复上！

### 文档系统重组

本周最显著的变化之一是对文档系统的重要重组。
[PR #34212](https://github.com/neovim/neovim/pull/34212)这项改进由 [@brianhuster](https://github.com/brianhuster) 完成：

- `builtin.txt` 重命名为 `vimfn.txt`：更清晰地表明该文件包含 Vim 脚本函数
- `eval.txt` 重命名为 `vimeval.txt`：更好地区分 Vim 兼容的求值功能

这一变更解决了长期以来的混淆问题，因为 `builtin.txt` 实际上只包含 Vimscript 函数，而非 Lua 函数，这对使用 Lua 配置 Neovim 的用户造成了困扰。文件重命名保留了原始标签，确保向后兼容性，同时提高了文档的清晰度和一致性。

### 外部 UI 接口改进

外部 UI 接口和消息系统得到了多项改进：

- [PR #34190](https://github.com/neovim/neovim/pull/34190) 改进了消息路由机制，使消息能够正确路由到"more"窗口（如果该窗口已打开）
- [Issue #34214](https://github.com/neovim/neovim/issues/34214) 修复了当消息窗口打开时，命令窗口(CTRL-F)被隐藏的问题
- [Issue #34213](https://github.com/neovim/neovim/issues/34213) 解决了两个内联打印语句触发'more'窗口时，只有第二条消息显示在窗口中的问题
- [#34184](https://github.com/neovim/neovim/issues/34184) 修复了 `winnr('$')` 在启用外部命令行 UI 时返回错误值的问题

这些改进共同提升了外部 UI 的用户体验和一致性，对使用自定义 UI 的用户尤为重要。

### LSP 功能增强

LSP（语言服务器协议）相关功能获得了多项重要改进：

1. 新增 `workspace/diagnostic` 方法支持 ([#34262](https://github.com/neovim/neovim/pull/34262))(尚未合并)：由 [@MariaSolOs](https://github.com/MariaSolOs) 实现，允许开发者查看整个工作区的诊断信息，而不仅限于已打开的文件
2. 改进 `vim.lsp.log.set_format_func()` 以控制日期和文件路径格式 ([#34118](https://github.com/neovim/neovim/issues/34118))：增强了 LSP 日志的可读性和自定义性

这些改进使 Neovim 的 LSP 客户端更加强大和灵活，特别是对于大型项目和 AI 辅助开发场景。

### 终端功能稳定性增强

[PR #34234](https://github.com/neovim/neovim/pull/34234) 修复了终端模式下处理过多 CSI 参数时可能导致的栈溢出问题。这一修复提高了终端模式的稳定性和可靠性，特别是在处理复杂终端输出时。

### Tree-sitter 升级

Tree-sitter 是 Neovim 用于代码解析和语法高亮的核心组件，本周有两项重要更新：

- [PR #34211](https://github.com/neovim/neovim/pull/34211) 将 Tree-sitter 版本升级到 v0.25.5，带来性能改进和 bug 修复
- [PR #34229](https://github.com/neovim/neovim/pull/34229) 修复了 Tree-sitter 解析器元数据注释的问题

这些更新直接提升了 Neovim 的语法高亮和代码分析功能的质量。

### Vim 补丁移植

Neovim 继续保持与 Vim 的功能兼容性，本周移植了多个 Vim 补丁：

- [PR #34219](https://github.com/neovim/neovim/pull/34219) 移植了 Vim 9.1.1417 补丁，修复了 `complete_info()` 函数中关于寄存器补全信息缺失的问题
- [PR #34251](https://github.com/neovim/neovim/pull/34251) 移植了 Vim 9.1.1419 补丁，改进了事件处理机制
- [PR #34239](https://github.com/neovim/neovim/pull/34239) 移植了 Vim 9.1.1342 补丁，改进了 Shebang 文件类型检测

### API 功能增强

Neovim 的 API 得到了多项增强和修复：

- [PR #34210](https://github.com/neovim/neovim/pull/34210) 修复了用户命令 Lua 回调中缺少 nargs 字段的问题
- [PR #34227](https://github.com/neovim/neovim/pull/34227) 改进了 `vim.system()` 函数在工作目录不存在时的错误消息
- [Issue #34208](https://github.com/neovim/neovim/issues/34208) 讨论了 `vim.fs.root()` 函数回退到 Nvim 当前目录的行为，但很可惜最终被标记了 no plan

### 显示和渲染改进

- [PR #34242](https://github.com/neovim/neovim/pull/34242) 修复了 Visual 选择模式下 curswant 更新的问题
- [Issue #34235](https://github.com/neovim/neovim/issues/34235) 修复了使用计数动作时块可视模式高亮显示错误的问题

### 构建系统改进

[PR #34238](https://github.com/neovim/neovim/pull/34238) 将 Windows CI 运行环境升级到 windows-2022，提升了构建系统的现代性和稳定性。

## 社区资讯

本周 Neovim 社区依然活跃，多个重要功能提案和讨论引发广泛关注。以下是本周的社区亮点：

### 内置插件管理器提案

[PR #34009](https://github.com/neovim/neovim/pull/34009) 提出实现内置插件管理器 `vim.pack`，这是社区长期以来的期待。该提案由 [mini.nvim](https://github.com/echasnovski/mini.nvim) 的作者 [echasnovski](https://github.com/echasnovski) 提出，设计思路沿用了他的 [mini.deps](https://github.com/echasnovski/mini.deps) 插件。

`vim.pack` 实现了一个 in-process LSP，用于为 `nvimpack` 提供目录等功能。根据当前设计，有两个功能明确不被考虑：

- 位于 `pack/*/start` 的插件。所有由 `vim.pack` 管理的插件都会被放到 `$XDG_DATA_HOME/nvim/site/pack/core/opt`，这引起了一定的争议。
- 插件懒加载。

由于内置插件管理器一直是社区关注的焦点，echasnovski 恳请所有非 Nvim Team 成员的用户在仔细思考留言是否有帮助后再添加评论，以避免该 PR 有过多的留言。

### 网络访问功能实现

[PR #33964](https://github.com/neovim/neovim/pull/33964) 实现了 Lua 模块 `vim.net`，用于支持网络访问功能。目前该模块仅实现了一个 API `vim.net.download()`，用于从指定的 URL 下载文件。

`vim.net` 可用于以下用途：

- 替换 `:h netrw` 的前置任务。[PR #32280](https://github.com/neovim/neovim/pull/32280) 希望能够将 Netrw 替换为若干个独立的 Lua 模块，主要原因是 Netrw 包含了太多功能，这意味着用户为了使用 Netrw 的某一个功能就必须启用 Netrw 提供的所有功能，不符合 Neovim 的设计哲学。
- 下载 `spellfile`（[Issue #7189](https://github.com/neovim/neovim/issues/7189)）
- 访问远端文件（`:e ftp://foo.bar/baz`）
- 下载 tree-sitter parser
- 用于插件管理器下载其自身

这是第三位尝试实现 `vim.net` 的开发者，前两次尝试（[PR #23461](https://github.com/neovim/neovim/pull/23461) 和 [PR #29104](https://github.com/neovim/neovim/pull/29104)）均未成功合并。当前实现的核心思路是一个使用 `vim.system()` 的 curl wrapper，特意维持该 PR 的实现最简化。

### GSoC 项目进展

Google Summer of Code (GSoC) 2025 的 Neovim 项目正在积极推进：

- [AI 导向的 LSP 功能](https://github.com/neovim/neovim/discussions/34254)：由 [ofseed](https://github.com/ofseed) 提出，旨在实现 AI 导向的 LSP 功能和 LSP 数据缓存模块。该项目将增强 Neovim 与 AI 工具的集成能力，并通过缓存机制提升 LSP 性能。

### 发行版和插件管理器讨论

社区中出现了关于 Neovim 发行版维护模式的讨论。[LazyVim](https://github.com/LazyVim/LazyVim) 是一个相当热门的 Neovim 发行版，然而长期以来，只有其维护者 [folke](https://github.com/folke) 拥有该仓库的 push 权限。这令一些用户感到担忧，并询问是否有由多人社区维护的发行版选择。

多数用户推荐了 [NvChad](https://github.com/NvChad/NvChad) 和 [AstroNvim](https://github.com/AstroNvim/AstroNvim) 作为社区维护的替代选择。

除了 LazyVim，folke 还持有众多热门 Neovim 插件，其中包括目前最流行的插件管理器 [lazy.nvim](https://github.com/folke/lazy.nvim)，这些项目的开发进度受到社区密切关注。

## 插件推荐

### [codecompanion-history.nvim](https://github.com/ravitemer/codecompanion-history.nvim)


AI 集成插件 CodeCompanion 的历史记录管理插件，使用体验非常棒，同时该插件作者也是 [mcphub.nvim](https://github.com/ravitemer/mcphub.nvim) 的作者！

## 总结

本周 Neovim 的开发和社区活动主要集中在文档系统重组、外部 UI 接口改进、内置插件管理器提案、网络访问功能实现以及 GSoC 项目进展上。这些改进和讨论共同推动了 Neovim 的发展，提升了其稳定性、功能性和用户体验。